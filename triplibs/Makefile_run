hpip_root=@HPIP_ROOT@
run=@RUN@
rep=@REP@

stats = Stats/Stats.json
raw_datadir = $(hpip_root)/data/raw/$(run)/HPIP_$(run)_$(rep)
sample_sheet = SampleSheet.csv
make_new_sample_sheet = python $(hpip_root)/hpipline/triplibs/make_new_sample_sheet.py

all : $(stats)

$(stats) : $(sample_sheet)
	bcl2fastq -R $(raw_datadir) -o . --no-lane-splitting --sample-sheet $^

$(sample_sheet) :
	echo "Making $(run) sample sheet"
	@$(make_new_sample_sheet) $(hpip_root) $(rep) $(run) > sample_sheet.log

# clean targets
.PHONY : clean

clean :
	rm -rf Stats Reports \
	  *.fastq.gz \
	  $(sample_sheet)
